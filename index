<!DOCTYPE html>
<html>
<head>
<title>Vérification de connexion</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = 'https://elampczhuvomffclwrex.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsYW1wY3podXZvbWZmY2x3cmV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNzc5MzUsImV4cCI6MjA3MjY1MzkzNX0.FCoXLqMDrg0_0XCQ8_ZP3bA2A8In-YnhSXOklxHaMZY';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

async function verifyToken() {
const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get('token');
const type = urlParams.get('type');

if (token && type === 'magiclink') {
try {
// Récupérer l'email du localStorage (stocké sur votre site principal)
const email = localStorage.getItem('emailForSignIn');

if (!email) {
document.getElementById('message').textContent = 'Erreur: Email non trouvé';
return;
}

const { data, error } = await supabase.auth.verifyOtp({
email,
token,
type: 'magiclink'
});

if (error) {
document.getElementById('message').textContent = 'Erreur: ' + error.message;
} else {
document.getElementById('message').textContent = 'Connexion réussie! Redirection...';
// Rediriger vers votre site principal
setTimeout(() => {
window.location.href = 'https://www.labonnedepense.com/avis-elec/';
}, 2000);
}
} catch (err) {
document.getElementById('message').textContent = 'Erreur: ' + err.message;
}
}
}

window.onload = verifyToken;
</script>
</head>
<body>
<div id="message">Vérification en cours...</div>
</body>
</html>
